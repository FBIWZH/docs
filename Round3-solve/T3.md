## $ T3 \ 啊?$

又是模板，，，

使用块状数组思想（分块）。

```cpp
#include<bits/stdc++.h>
using namespace std;
#define M 50005
int n,s,a[M],b[M],st[M],ed[M],mx,yc[M];
inline void rebuild(int x)
{//块内排序 
	for(int i=st[x];i<=ed[x];++i)b[i]=a[i];
	sort(b+st[x],b+ed[x]+1);
}
inline void build(int l,int r,int c)
{//零散点直接暴力修改 
	for(int i=l;i<=r;++i)a[i]+=c;
	rebuild(l/s);
}
inline void update(int l,int r,int c)
{
	if(l/s==r/s)build(l,r,c);
	else{
		build(l,ed[l/s],c),build(st[r/s],r,c);
		for(int i=l/s+1;i<r/s;++i)yc[i]+=c;//对整块直接标记 
	}
}
inline int find(int l,int r,int c)
{//对于整块的答案二分查找 
	int x=l/s;
	while(l<=r){
		int mid=(l+r)>>1;
		if(b[mid]+yc[x]<c*c)l=mid+1;
		else r=mid-1;
	}
	return l-st[x];
}
inline int query(int l,int r,int c)
{
	if(l/s==r/s){
		int x=l/s,ans=0;
		for(int i=l;i<=r;++i)ans+=a[i]+yc[x]<c*c;
		return ans;
	}
	else{
		int L=l/s,R=r/s,ans=0;
		for(int i=l;i<=ed[L];++i)ans+=a[i]+yc[L]<c*c;
		for(int i=st[R];i<=r;++i)ans+=a[i]+yc[R]<c*c;
		for(int i=l/s+1;i<r/s;++i)ans+=find(st[i],ed[i],c);
		return ans;
	}
    return 0;
}
int main()
{
	scanf("%d",&n);
	for(int i=1;i<=n;++i)scanf("%d",&a[i]);
	s=sqrt(n)+1;mx=n/s;
	memset(st,63,sizeof(st));
	for(int i=1;i<=n;++i){
		st[i/s]=min(st[i/s],i);
		ed[i/s]=i;
	}
	for(int i=0;i<=mx;++i)rebuild(i);
	for(int i=1,p,l,r,c;i<=n;++i){
		scanf("%d%d%d%d",&p,&l,&r,&c);
		if(p==0)update(l,r,c);
		else printf("%d\n",query(l,r,c));
	}
}
```

